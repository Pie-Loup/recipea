<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Sauce</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial, sans-serif; background: #f7f7f7; display: flex; align-items: center; justify-content: center; height: 100vh; }
        .login-container { background: #fff; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .login-btn { width: 100%; margin: 0.5rem 0; padding: 0.75rem; border: none; border-radius: 4px; font-size: 1rem; cursor: pointer; }
        .google { background: #4285F4; color: #fff; }
        .facebook { background: #3b5998; color: #fff; }
    </style>
</head>
<body>
    <div class="login-container">
        <h2>Login to Sauce</h2>
        <button class="login-btn google" onclick="loginWithProvider('google')">Login with Google</button>
        <button class="login-btn facebook" onclick="loginWithProvider('facebook')">Login with Facebook</button>
    </div>
    <script>
        // Supabase project URL and anon key
        const SUPABASE_URL = "{{ supabase_url }}";
        const SUPABASE_ANON_KEY = "{{ supabase_anon_key }}";
        const SITE_URL = "{{ site_url }}";
        const client = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        async function loginWithProvider(provider) {
            const { data, error } = await client.auth.signInWithOAuth({
                provider: provider,
                options: {
                    redirectTo: SITE_URL + '/feed'
                }
            });
            if (error) console.error('Error:', error.message);
        }

        // Check session on page load
        client.auth.getSession().then(({ data: { session } }) => {
            if (session) {
                window.location.href = '/feed';
            }
        });

        // Listen for auth state changes (for after login redirect)
        client.auth.onAuthStateChange((event, session) => {
            if (session) {
                // Set cookie for backend (expires in 7 days, path=/)
                document.cookie = `sb-access-token=${session.access_token}; path=/; max-age=604800; SameSite=Lax`;
                window.location.href = '/feed';
            }
        });

        async function loginWithProvider(provider) {
            const { data, error } = await client.auth.signInWithOAuth({ provider });
            if (error) alert('Error: ' + error.message);
            // On success, Supabase will redirect to your site with a session
        }
    </script>
</body>
</html>
